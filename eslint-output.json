[{"filePath":"/Users/sreebhargav/AgentPR/AgentPR/dummy.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/sreebhargav/AgentPR/AgentPR/src/__tests__/sample.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/sreebhargav/AgentPR/AgentPR/src/agents/coverageAgent.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":46,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1422,1425],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1422,1425],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import fs from 'fs';\nimport path from 'path';\nimport axios from 'axios';\nimport dotenv from 'dotenv';\n\ndotenv.config();\n\nexport async function runCoverageAgent() {\n  try {\n    const token = process.env.GITHUB_TOKEN!;\n    const repoFull = process.env.GITHUB_REPO!;\n    const [owner, repo] = repoFull.split('/');\n    const prNumber = parseInt(process.env.PR_NUMBER!, 10);\n\n    const headers = {\n      Authorization: `token ${token}`,\n      Accept: 'application/vnd.github+json',\n      'User-Agent': 'AgentPR-Bot',\n    };\n\n    const coveragePath = path.resolve(__dirname, '../../coverage/coverage-summary.json');\n    const coverage = JSON.parse(fs.readFileSync(coveragePath, 'utf-8'));\n    const total = coverage.total;\n\n    const formatPercent = (value: unknown) => {\n      const num = typeof value === 'number' ? value : 0;\n      return `${num.toFixed(2)}%`;\n    };\n\n    const message = `\nüìä **Test Coverage Report**\n- **Lines:** ${formatPercent(total.lines.pct)}\n- **Statements:** ${formatPercent(total.statements.pct)}\n- **Functions:** ${formatPercent(total.functions.pct)}\n- **Branches:** ${formatPercent(total.branches.pct)}\n`;\n\n    // Post a top-level comment on the PR (via issues API)\n    await axios.post(\n      `https://api.github.com/repos/${owner}/${repo}/issues/${prNumber}/comments`,\n      { body: message },\n      { headers }\n    );\n\n    console.log('‚úÖ Posted test coverage comment to PR');\n  } catch (error: any) {\n    console.error('‚ùå Failed to post test coverage comment:', error.response?.data || error.message);\n  }\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/sreebhargav/AgentPR/AgentPR/src/agents/lintParser.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/sreebhargav/AgentPR/AgentPR/src/agents/postLintComments.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'temp' is assigned a value but never used.","line":9,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":11},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":9,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[178,181],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[178,181],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":99,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":99,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2973,2976],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2973,2976],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":120,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":120,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3570,3573],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3570,3573],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import fs from 'fs';\nimport path from 'path';\nimport axios from 'axios';\nimport dotenv from 'dotenv';\n\ndotenv.config();\n\n// Intentional TypeScript lint error to test\nconst temp: any = 'trigger error';\n\nexport async function runLintAgent() {\n  const token = process.env.GITHUB_TOKEN!;\n  const repoFull = process.env.GITHUB_REPO!;\n  const [owner, repo] = repoFull.split('/');\n  const prNumber = parseInt(process.env.PR_NUMBER!, 10);\n\n  const headers = {\n    Authorization: `token ${token}`,\n    Accept: 'application/vnd.github+json',\n    'User-Agent': 'AgentPR-Bot',\n  };\n\n  const results = JSON.parse(\n    fs.readFileSync(path.resolve(__dirname, '../../eslint-output.json'), 'utf-8')\n  );\n\n  const repoRoot = path.resolve(__dirname, '../../');\n\n  const getChangedFiles = async () => {\n    const { data } = await axios.get(\n      `https://api.github.com/repos/${owner}/${repo}/pulls/${prNumber}/files`,\n      { headers }\n    );\n    return data.map((f: { filename: string; patch: string }) => ({\n      filename: f.filename,\n      patch: f.patch,\n    }));\n  };\n\n  const extractChangedLines = (patch: string): Set<number> => {\n    const changedLines = new Set<number>();\n    const lines = patch.split('\\n');\n    let newLine = 0;\n    for (const line of lines) {\n      if (line.startsWith('@@')) {\n        const match = /@@ -\\d+,\\d+ \\+(\\d+),?(\\d+)? @@/.exec(line);\n        if (match) newLine = parseInt(match[1], 10);\n        continue;\n      }\n      if (line.startsWith('+') && !line.startsWith('+++')) {\n        changedLines.add(newLine);\n        newLine++;\n      } else if (!line.startsWith('-')) {\n        newLine++;\n      }\n    }\n    return changedLines;\n  };\n\n  try {\n    const prRes = await axios.get(\n      `https://api.github.com/repos/${owner}/${repo}/pulls/${prNumber}`,\n      { headers }\n    );\n    const head_sha = prRes.data.head.sha;\n    const changedFiles = await getChangedFiles();\n\n    const fileToChangedLines = new Map<string, Set<number>>();\n    changedFiles.forEach((file: { filename: string; patch: string }) => {\n      fileToChangedLines.set(file.filename, extractChangedLines(file.patch));\n    });\n\n    let commentsPosted = 0;\n\n    for (const result of results) {\n      const filePath = path.relative(repoRoot, result.filePath);\n      if (!fileToChangedLines.has(filePath)) continue;\n\n      const changedLines = fileToChangedLines.get(filePath)!;\n\n      for (const message of result.messages) {\n        if (!changedLines.has(message.line)) continue;\n\n        const commentBody = `Error: ${message.message}\\nRule: \\`${message.ruleId || 'n/a'}\\``;\n\n        try {\n          await axios.post(\n            `https://api.github.com/repos/${owner}/${repo}/pulls/${prNumber}/comments`,\n            {\n              body: commentBody,\n              commit_id: head_sha,\n              path: filePath,\n              line: message.line,\n              side: 'RIGHT',\n            },\n            { headers }\n          );\n          commentsPosted++;\n        } catch (error: any) {\n          console.warn(\n            `‚ùå Failed to post comment on ${filePath}:${message.line}`,\n            error.response?.data?.message || error.message\n          );\n        }\n      }\n    }\n\n    // ‚úÖ CORRECT fallback: general PR-level comment\n    if (commentsPosted === 0) {\n      await axios.post(\n        `https://api.github.com/repos/${owner}/${repo}/issues/${prNumber}/comments`,\n        {\n          body: '‚úÖ Lint completed, but no inline comments were necessary.',\n        },\n        { headers }\n      );\n    }\n\n    console.log('‚úÖ Lint Agent execution completed.');\n  } catch (error: any) {\n    console.error(\n      '‚ùå Unexpected Lint Agent failure:',\n      error.response?.data?.message || error.message\n    );\n  }\n}\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/sreebhargav/AgentPR/AgentPR/src/agents/triageAgent.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":7,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[247,250],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[247,250],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { classifyRiskLevel } from '../utils/classifier';\nimport { postPRLabel } from '../services/githubService';\n\n/**\n * Triage Agent: classifies PRs based on title/body and applies risk label\n */\nexport async function handlePullRequest(payload: any) {\n  const prTitle = payload.pull_request.title;\n  const prBody = payload.pull_request.body || '';\n  const prNumber = payload.pull_request.number;\n  const repo = payload.repository.name;\n  const owner = payload.repository.owner.login;\n\n  const risk = classifyRiskLevel(`${prTitle} ${prBody}`);\n  await postPRLabel(owner, repo, prNumber, risk);\n\n  console.log(`‚úÖ Applied label: ${risk}`);\n}\n\n\n\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/sreebhargav/AgentPR/AgentPR/src/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/sreebhargav/AgentPR/AgentPR/src/routes/github.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/sreebhargav/AgentPR/AgentPR/src/services/githubService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":34,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[854,857],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[854,857],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import axios from 'axios';\nimport dotenv from 'dotenv';\n\ndotenv.config(); // Ensure this is called so env vars are loaded\n\nexport const postPRLabel = async (\n  owner: string,\n  repo: string,\n  prNumber: number,\n  label: string\n) => {\n  const token = process.env.GITHUB_TOKEN;\n  console.log('GitHub token:', token); \n\n  if (!token) {\n    throw new Error('GitHub token is missing. Check your .env file');\n  }\n\n  try {\n    const response = await axios.post(\n      `https://api.github.com/repos/${owner}/${repo}/issues/${prNumber}/labels`,\n      { labels: [label] },\n      {\n        headers: {\n          Authorization: `token ${token}`,\n          Accept: 'application/vnd.github+json',\n          'User-Agent': 'AgentPR-Bot'\n        }\n      }\n    );\n\n    console.log(`‚úÖ Label \"${label}\" added to PR #${prNumber}`);\n    return response.data;\n  } catch (error: any) {\n    console.error('‚ùå Failed to add label');\n    if (error.response) {\n      console.error('Status:', error.response.status);\n      console.error('Headers:', error.response.headers);\n      console.error('Data:', error.response.data);\n    } else if (error.request) {\n      console.error('No response received:', error.request);\n    } else {\n      console.error('Error setting up request:', error.message);\n    }\n    throw error;\n  }\n};\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/sreebhargav/AgentPR/AgentPR/src/utils/classifier.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"/Users/sreebhargav/AgentPR/AgentPR/src/utils/math.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]}]